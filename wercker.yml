box: somada141/python-miniconda@0.0.4
build:
  steps:
    - script:
        name: python environment
        code: |
          info "$(python --version)"
          info "$(conda --version)"
          
    - script:
        name: create and activate Python 2.7 virtual environment
        code: |
          conda create --yes -n py27 python=2.7           
          source activate py27

    - script:
        name: install required packages
        code: |
          conda install --yes coverage lxml matplotlib nose numpy pandas pip requests scipy seaborn statsmodels sympy xlrd pillow
          pip install https://github.com/lmfit/lmfit-py/archive/800f3e40ef8ba977005d27a5d05fd231688a5749.zip              
          python setup.py install

    - script:
        name: test
        code: nosetests --with-coverage --cover-package=curveball --cover-inclusive --cover-html --cover-html-dir=$SRC_COVERAGE_DIR

deploy :
  steps :
    - script:
        name: configure git and clone gh-pages branch
        code: |-
          git config --global user.email "pleasemailus@wercker.com"
          git config --global user.name "wercker"
          git clone -b gh-pages $GIT_REMOTE gh-pages
    - script:
        name: deploy coverage report to github pages
        code: |
          cp -R $SRC_COVERAGE_DIR/* gh-pages/$DST_COVERAGE_DIR
          cd gh-pages              
          git commit $DST_COVERAGE_DIR -m "Updated code coverage: `date +'%Y-%m-%d%k:%M:%S'`, commited from $WERCKER_STARTED_BY"
          git push origin gh-pages
